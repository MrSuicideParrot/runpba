#-------------------------------------------------------------------------------
# Copyright (c) 2020-2022, Arm Limited. All rights reserved.
#
# SPDX-License-Identifier: BSD-3-Clause
#
#-------------------------------------------------------------------------------

#if (NOT TFM_PACBTI_SERVICE)
#    return()
#endif()

cmake_minimum_required(VERSION 3.15)
cmake_policy(SET CMP0079 NEW)


# The name of the target is required to be of the pattern
# tfm_app_rot_partition_x or tfm_psa_rot_partition_x, as it affects how the
# linker script will lay the partition in memory.
add_library(tfm_app_rot_partition_pacbti_service STATIC)

target_sources(tfm_app_rot_partition_pacbti_service
    PRIVATE
        pacbti_service.c
        pacbti_service_req_mngr.c
)

# Add the source files generated by parse tools when building.
# The intermedia file defines the partition stack.
target_sources(tfm_app_rot_partition_pacbti_service
    PRIVATE
        ${CMAKE_BINARY_DIR}/generated/secure_fw/partitions/pacbti_service/auto_generated/intermedia_tfm_pacbti_service.c
)

# The load info file includes the static data of the partition.
target_sources(tfm_partitions
    INTERFACE
        ${CMAKE_BINARY_DIR}/generated/secure_fw/partitions/pacbti_service/auto_generated/load_info_tfm_pacbti_service.c
)

target_include_directories(tfm_app_rot_partition_pacbti_service
    PRIVATE
        ${CMAKE_CURRENT_SOURCE_DIR}
    PUBLIC
        ${CMAKE_BINARY_DIR}/generated/secure_fw/partitions/pacbti_service
)

# Add dependency to the manifest_tool
#add_dependencies(tfm_app_rot_partition_pacbti_service manifest_tool)

target_link_libraries(tfm_app_rot_partition_pacbti_service
    PRIVATE
        secure_fw
        platform_s
        tfm_config
        tfm_sprt
)

############################ Secure API ########################################

set(INTERFACE_SRC_DIR            ${CMAKE_CURRENT_SOURCE_DIR}/interface/src)
set(INTERFACE_INC_DIR            ${CMAKE_CURRENT_SOURCE_DIR}/interface/include)

target_sources(tfm_sprt
    INTERFACE
        ${INTERFACE_SRC_DIR}/tfm_pacbti_service_api.c
)

target_include_directories(tfm_sprt
    PUBLIC
        ${INTERFACE_INC_DIR}
)

############################ Non-secure API ####################################

#add_library(pacbti_service_api_ns INTERFACE)

#target_sources(pacbti_service_api_ns
#    INTERFACE
#        ${INTERFACE_SRC_DIR}/tfm_pacbti_service_api.c
#)

#target_include_directories(pacbti_service_api_ns
#    INTERFACE
#        ${INTERFACE_INC_DIR}
#)

############################ Partition Defs ####################################

target_link_libraries(tfm_partitions
    INTERFACE
        tfm_app_rot_partition_pacbti_service
)

target_compile_definitions(tfm_config
    INTERFACE
        TFM_PACBTI_SERVICE
)

set(INSTALL_INTERFACE_SRC_DIR    ${TFM_INSTALL_PATH}/interface/src)
set(INSTALL_INTERFACE_INC_DIR    ${TFM_INSTALL_PATH}/interface/include)

install(FILES       ${INTERFACE_SRC_DIR}/tfm_pacbti_service_api.c
        DESTINATION ${INSTALL_INTERFACE_SRC_DIR})

install(FILES       ${INTERFACE_INC_DIR}/tfm_pacbti_service.h
                    ${INTERFACE_INC_DIR}/tfm_pacbti_service_def.h
        DESTINATION ${INSTALL_INTERFACE_INC_DIR})