# RUNPBA - Runtime attestation for microcontrollers with PACBTI

Runtime PACBTI Attestation (RunPBA) is a runtime attestation system that leverages the PACBTI extension and ARM TrustZone to address the limitations of hybrid runtime attestation solutions. RunPBA uses the PACBTI extension to monitor for any attempt to espace from the intended execution flow, and leverages the [Trusted Firmware-M](https://tf-m-user-guide.trustedfirmware.org/)(TF-M) as a Root of Trust to securely execute its logic.

For more details about RunPBA checkout the [academic paper](). To cite this work you can use the following BibTex entry:

```bibtex



```

## Build environment

RunPBA uses the same build environment of the TF-M. So before attempting to compile RunPBA it is necessary to setup the appropriate environment. The instructions are available [here](https://trustedfirmware-m.readthedocs.io/en/latest/getting_started/index.html#set-up-build-environments). The only additional requirement that doesn't appear in these instruction is that the toolchain version must support PACBTI extension. During the development we used the [Arm GNU Toolchain 12.2.MPACBTI-Rel1](https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads/12-2-mpacbti-rel1). Other compilers should be able to build this project as long as they support PACBTI.

## Compilation instructions
This project can be compiled by running:
```shell
bash build.sh
```
This build script targets [Corstone SSE-310](https://tf-m-user-guide.trustedfirmware.org/platform/arm/mps3/corstone310/README.html) platform, an Arm reference subsystem containing an Armv8.1-M Cortex-M85.

The binaries and firmware images generated by the build process are stored at `/trusted-firmware-m-runpba/build/bin`.

## Project structure

* `ns_app`: Non-secure application with a secret message stored into memory  and  a buffer overflow that can be exploited through a  *rop chain attack*  to read it.  
* `pacbti_service`: An application RoT partition implementing the RunPBA logic.
* `scripts`: Auxiliary scripts for debug and testing RunPBA functionality.
* `trusted-firmware-m-runpba`: A version of TF-M with a custom fault-handler dedicated to PACBTI, to delegate its handling to RunPBA.

## How to test RunPBA

The simplest way to execute RunPBA is to use the Corstone SSE-310 Fixed Virtual Platform (FVP). The script `run.sh` calls this virtualization tecnology to run RunPBA with our sample non-secure application. The script called `exploit_script.py` can be used to test the ability of RunPBA to stop control-flow attacks. Moroever, the Corstone SSE-310 (FVP) can be used in conjunction with a debugger to better understand the inner workings of RunPBA.

These tests can be also run in a Arm MPS3 FPGA and in future boards with the Arm Cortex-M85 and Arm Cortex-M55, assuming the necessary changes are done to TF-M.

## Benchmark data and scripts

During the development of this work we did an evaluation of its performance overhead. The source code of the tests and its results are available [here](https://github.com/MrSuicideParrot/pacbti-benchmark).